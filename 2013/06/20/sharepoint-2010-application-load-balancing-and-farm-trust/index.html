<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sharepoint 2010 Application Load Balancing and farm trust | Debajyoti Mahanta</title>
  <meta name="author" content="Debajyoti Mahanta">
  
  <meta name="description" content="I have been recently working on a sharepoint2010 to 2013 migration project, and even though this might not be related to migration we stumbled upon an">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Sharepoint 2010 Application Load Balancing and farm trust"/>
  <meta property="og:site_name" content="Debajyoti Mahanta"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">

  <link rel="alternate" href="/atom.xml" title="Debajyoti Mahanta" type="application/atom+xml">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/print.css" media="print" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

  <script src="/js/scripts.js"></script>

  
  
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config(
    {
      tex2jax: {inlineMath: [['$','$'], ['\(','\)']]},
      TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}},
    }
  );
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
</head>


<body>
    <div class="container">
      <div class="left-col">
        <div class="intrude-less">
          <header id="header" class="inner">
            <div class="profilepic">
  <script src="/js/md5.js"></script>
  <script type="text/javascript">
    $(function(){
	$('.profilepic').append(
          "<img src='http://www.gravatar.com/avatar/"
          + MD5("")
          + "?s=160' alt='Profile Picture' style='width: 160px;' />");
    });
  </script>
</div><!-- profilepic -->
<h1><a href="/">Debajyoti Mahanta</a></h1>
<nav id="main-nav">
  <ul class="main">
    
      <li>
      <a href="/about">About</a>
      </li>
    
  </ul>
  
</nav><!-- main-nav -->
<nav id="sub-nav">
  <div class="social">
    
      <a class="google" href="http://plus.google.com/debajyoti.mahanta"
         title="Google+">Google+</a>
    
    
      <a class="twitter" href="http://twitter.com/dmahanta"
         title="Twitter">Twitter</a>
    
    
      <a class="github" href="http://github.com/debajyotimahanta"
         title="Github">Github</a>
    
    
        <a class="rss" href="/atom.xml" title="RSS">RSS</a>
    
  </div>
</nav><!-- sub-nav -->
<nav id="widget-nav">
  <div class="widgets">
    
      
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/C-Nancy-Security-NET/">C# Nancy Security .NET</a><small>1</small></li>
  
    <li><a href="/tags/CI/">CI</a><small>1</small></li>
  
    <li><a href="/tags/DIY/">DIY</a><small>1</small></li>
  
    <li><a href="/tags/IoT/">IoT</a><small>1</small></li>
  
    <li><a href="/tags/SOA/">SOA</a><small>1</small></li>
  
    <li><a href="/tags/Security/">Security</a><small>1</small></li>
  
    <li><a href="/tags/SharePoint-2013-Apps-Security-cross-site/">SharePoint 2013 Apps Security cross-site</a><small>1</small></li>
  
    <li><a href="/tags/Sharepoint2013-Sharepoint-ManagedMetadataService/">Sharepoint2013 Sharepoint ManagedMetadataService</a><small>1</small></li>
  
    <li><a href="/tags/WCF-Sharepoint2010-ClaimsBasedAuthentication-Sharepoint2013-C-Sharepoint/">WCF Sharepoint2010 ClaimsBasedAuthentication Sharepoint2013 C# Sharepoint</a><small>1</small></li>
  
    <li><a href="/tags/XHR/">XHR</a><small>1</small></li>
  
    <li><a href="/tags/ajax/">ajax</a><small>1</small></li>
  
    <li><a href="/tags/angularjs/">angularjs</a><small>1</small></li>
  
    <li><a href="/tags/api/">api</a><small>1</small></li>
  
    <li><a href="/tags/aws/">aws</a><small>2</small></li>
  
    <li><a href="/tags/azure/">azure</a><small>1</small></li>
  
    <li><a href="/tags/bower/">bower</a><small>1</small></li>
  
    <li><a href="/tags/clientside/">clientside</a><small>1</small></li>
  
    <li><a href="/tags/cloud/">cloud</a><small>1</small></li>
  
    <li><a href="/tags/coffescript/">coffescript</a><small>1</small></li>
  
    <li><a href="/tags/devops/">devops</a><small>1</small></li>
  
    <li><a href="/tags/grunt/">grunt</a><small>1</small></li>
  
    <li><a href="/tags/gulp/">gulp</a><small>1</small></li>
  
    <li><a href="/tags/hardware/">hardware</a><small>1</small></li>
  
    <li><a href="/tags/ionic/">ionic</a><small>1</small></li>
  
    <li><a href="/tags/iot/">iot</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>5</small></li>
  
    <li><a href="/tags/jquery/">jquery</a><small>1</small></li>
  
    <li><a href="/tags/lync/">lync</a><small>1</small></li>
  
    <li><a href="/tags/microsfot/">microsfot</a><small>1</small></li>
  
    <li><a href="/tags/node/">node</a><small>2</small></li>
  
    <li><a href="/tags/node-js/">node.js</a><small>1</small></li>
  
    <li><a href="/tags/opensource/">opensource</a><small>1</small></li>
  
    <li><a href="/tags/raspberry-pi/">raspberry pi</a><small>1</small></li>
  
    <li><a href="/tags/sharepoint-html/">sharepoint.html</a><small>1</small></li>
  
  </ul>
</div>


    
  </div>
</nav><!-- widget-nav -->

          <header>
        </div><!-- intrude-less -->
      </div><!-- left-col -->
      <div class="mid-col">
        <div class="mid-col-container">
	    <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
	<div class="meta">
          
<div class="date">

<time datetime="2013-06-21T03:19:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2013-06-20
</time>





</div>

          
          
<div class="print">打印</div>

          
	</div>
        <h1 class="title" itemprop="name">Sharepoint 2010 Application Load Balancing and farm trust</h1>
      	<div class="entry-content" itemprop="articleBody"><p>I have been recently working on a sharepoint2010 to 2013 migration project, and even though this might not be related to migration we stumbled upon an issue, which took forver to be resolved. Before i dive into the issue, let me explain the background and give you a run down of what was happening.</p>
<p>###Background<br>As a part of the migration, we where moving existing application from a fairly open data center to a location where everything is locked down. So when we did the move, we found that another farm, which was consuming the Managed Metadata service, wasn’t able to do this. This was expected, and we knew we had to open up firewalls, but what firewalls. Internally sharepoint user topology service to expose all its end points published as a service. So what we ended up doing is opening the firewall between two servers, which enable traffic over 32844 and 32843.(Prior to this we also had to setup trust and all the stuff require to publish managed metadata across farm. More can be found this this <a href="http://blogs.msdn.com/b/spses/archive/2011/11/28/managed-metadata-taxonomy-amp-more.aspx" target="_blank" rel="external">article</a>).</p>
<p>###Error<br>So ideally this should work, and in a way it did. When we try to connect to our farm form the external farm, we where able to see all the service and even add them. However thats all we could do. We couldn’t consume the services. After reviewing the log we found this error<br>    Microsoft.SharePoint.SPException: Addresses for this application have not yet been fetched. </p>
<p>###Solution<br>After chaning our logs to be verbose, we found that sharepoint was trying not only connect to the application server where the service was hosted but also to the other servers in the fram. Why, even though the service was turned off? Till date i couldn’t figure out. However i learned that sharepoint internal does some kind of load balancing on its own for the topology service and since we hadn’t open up the entire farm to each other, we where getting the error as it couldn’t fetch the other site via the url.(More details about load balancing can be found <a href="http://blogs.msdn.com/b/besidethepoint/archive/2011/02/19/how-i-learned-to-stop-worrying-and-love-the-sharepoint-topology-service.aspx" target="_blank" rel="external">here</a>)</p>
<p>###Conslusion<br>So after opening up ports between all the servers in the farm we where able to consume the Managed Metadata Service as well as view it from the other farm. So opening just the ports to the app server isn’t sufficient because of Sharepoint’s internal load balancing feature, which i know is being done with the right thoughts in mind. We want to make the service highly available. However we missed this one small thing, and it caused us a lot of pain and time. Also as a side note, we even tried to spoof this, but creating an entry in the DNS so that all url/server point to one IP, which is of the server to which the port is open. However this didnt help because the SSL certificate for some reason goofed up and we get error related to SSL/TSL trust issue as WCF level. So we can conclude that there is no option but to open up the firewalls for the entire farm. If there are other ways to get around this, i will surely like to know and fell free to drop me a line and we can hook up.</p>
</div>


</article>

  <div class="share">
  <div class="addthis_toolbox addthis_default_style ">
  
  
  <a class="addthis_button_tweet"></a>
  
  
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  
  
  </div>
  <script type="text/javascript">
    var addthis_config = {"data_track_addressbar":true};
  </script>
  <script type="text/javascript"
          src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=null">
  </script>
</div>




</div>
	</div>
        <footer id="footer" class="inner">
          Copyright © 2013 - Debajyoti Mahanta - Powered by <a href="https://github.com/tommy351/hexo">Hexo</a><br>
- Ported theme <a href="https://github.com/nuklly/hexo-theme-greyshade">GreyShade</a> -
        </footer>
        
<script src="/js/slash.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




      </div><!-- mid-col -->
    </div><!-- container -->
</body>
</html>
